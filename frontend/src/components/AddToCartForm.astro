---
interface Props {
  id: string
  title: string
  imageRef: string
}

const { id, title, imageRef } = Astro.props;
---

<add-to-cart-form data-id={id} data-title={title} data-image-ref={imageRef}>
<form>
  <button type="submit">
    <slot />
  </button>
</form>
</add-to-cart-form>

<script>
  import { addCartItem, $isCartOpen } from '../store/cart';

  class AddToCartForm extends HTMLElement {
    form = null
    itemInfo = null

    constructor() {
      super();
      this.form = this.querySelector('form');
      this.itemInfo = {
        id: this.getAttribute('data-id'),
        title: this.getAttribute('data-title'),
        imageRef: this.getAttribute('data-image-ref'),
      };
    }

    addToCart = (e: SubmitEvent) => {
      e.preventDefault();
      $isCartOpen.set(true);
      addCartItem(this.itemInfo);
    }

    connectedCallback() {
      this.form.addEventListener('submit', this.addToCart);
    }

    disconnectedCallback() {
          this.form.removeEventListener('submit', this.addToCart);
    }
  }

  customElements.define('add-to-cart-form', AddToCartForm);
</script>
